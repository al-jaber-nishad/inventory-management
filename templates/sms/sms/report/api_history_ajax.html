{% load static %}
<div id="sms-list">
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>SL</th>
                    <th>Receiver</th>
                    <th>Text</th>
                    <th>Status</th>
                    <th>Gateway Type</th>
                    <th>Date</th>
                    {% if request.user.role.name == "ADMIN" %}
                        <th>Route API</th>
                        <th>Reseller</th>
                    {% endif %}
                    {% if not request.user.role.name == "CLIENT" %}
                        <th>Client</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for sms in sms_list %}
                    <tr class="sms-row" 
                        data-receiver="{{ sms.receiver }}" 
                        data-message="{{ sms.message }}" 
                        data-ip="{{ sms.sender_ip_address }}" 
                        data-message_count="{{ sms.msg_part_count }}" 
                        data-date="{{ sms.sent_at }}"
                    >
                        <td>{{ forloop.counter|add:sms_list.start_index|add:-1 }}</td>
                        <td>{{ sms.receiver }}</td>
                        <td>
                            {% if sms.message|length > 10 %}
                                {{ sms.message|slice:":15" }}...
                            {% else %}
                                {{ sms.message }}
                            {% endif %}
                        </td>
                        <td>{{ sms.status }}</td>
                        <td>{{ sms.gateway_type }}</td>
                        <td>
                            {% if sms.sent_at %}
                                {{ sms.sent_at }}
                            {% else %}
                                {{ sms.created_at }}
                            {% endif %}
                        </td>
                        {% if request.user.role.name == "ADMIN" %}
                            <td>{{ sms.sms_api.name }}</td>
                            <td>{{ sms.sender.owner_user.username }}</td>
                        {% endif %}
                        {% if not request.user.role.name == "CLIENT" %}
                            <td>{{ sms.sender.username }}</td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Pagination Links -->
    <div class="pagination-container d-flex justify-content-between">
        <div class="pagination table-info">
            {% if sms_list %}
                <p>
                    Showing 
                    {{ sms_list.start_index }} 
                    to 
                    {{ sms_list.end_index }} 
                    of 
                    {{ sms_list.paginator.count }} 
                    entries
                </p>
            {% endif %}
        </div>
        <nav aria-label="Page navigation">
            <ul class="pagination">
                {% if sms_list.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ sms_list.previous_page_number }}" data-page="{{ sms_list.previous_page_number }}"><</a>
                    </li>
                {% endif %}
                <!-- Always show the first page -->
                {% if 1 != sms_list.number and sms_list.number > 4 %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1" data-page="1">1</a>
                    </li>
                {% endif %}
    
                <!-- Show ellipsis if there is a gap between first and current page -->
                {% if sms_list.number > 4 %}
                    <li class="page-item disabled"><span class="page-link">...</span></li>
                {% endif %}
    
                <!-- Display pages near the current page -->
                {% for num in sms_list.paginator.page_range %}
                
                    {% if sms_list.number < 5 %}
                        {% if num <= 5 %}
                            <li class="page-item {% if sms_list.number == num %}active{% endif %}">
                                <a class="page-link" href="?page={{ num }}" data-page="{{ num }}">{{ num }}</a>
                            </li>
                        {% endif %}
                    {% comment %} {% elif sms_list.number|add:-5 < sms_list.paginator.num_pages %}
                        {% if num >= sms_list.number|add:-1 and num <= sms_list.number|add:4 %}
                            <li class="page-item {% if sms_list.number == num %}active{% endif %}">
                                <a class="page-link" href="?page={{ num }}" data-page="{{ num }}">{{ num }}</a>
                            </li>
                        {% endif %} {% endcomment %}
                    {% else %}
                        {% if num >= sms_list.number|add:-1 and num <= sms_list.number|add:1 %}
                            <li class="page-item {% if sms_list.number == num %}active{% endif %}">
                                <a class="page-link" href="?page={{ num }}" data-page="{{ num }}">{{ num }}</a>
                            </li>
                        {% endif %}
                    {% endif %}
                    
                    
                {% endfor %}
    
                <!-- Show ellipsis if there is a gap between current and last page -->
                {% if sms_list.number < sms_list.paginator.num_pages|add:-3 %}
                    <li class="page-item disabled"><span class="page-link">...</span></li>
                {% endif %}

                <!-- Always show the last page -->
                {% if sms_list.number|add:"3" < sms_list.paginator.num_pages %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ sms_list.paginator.num_pages }}" data-page="{{ sms_list.paginator.num_pages }}">{{ sms_list.paginator.num_pages }}</a>
                    </li>
                {% endif %} 
                {% if sms_list.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ sms_list.next_page_number }}" data-page="{{ sms_list.next_page_number }}">></a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    </div>
     
</div>


<script>
$(document).ready(function() {
    // SMS Details pop up
    $('.sms-row').on('click', function() {
        // Get the SMS details from the row's data attributes
        var receiver = $(this).data('receiver');
        var message = $(this).data('message');
        var ip = $(this).data('ip');
        var message_count = $(this).data('message_count');
        var date = $(this).data('date');

        // Show SweetAlert modal with SMS details
        Swal.fire({
            title: 'SMS Details',
            html: `<p><strong>Receiver:</strong> ${receiver}</p>
                    <p><strong>Message:</strong> ${message}</p>
                    <p><strong>IP Address:</strong> ${ip}</p>
                    <p><strong>Message Count:</strong> ${message_count}</p>
                    <p><strong>Date:</strong> ${date}</p>`,
            icon: 'info',
            confirmButtonText: 'OK'
        });
    });
});
</script>